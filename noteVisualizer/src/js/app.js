
//require('raphael.js');
//var Raphael = require('../../third-party/raphael.js');

var Raphael = require('raphael');
var font = require("./font.js");
//var font = require("./vexFont.js");
var staveData = require("./stave.js");
var Note = require("./note.js");
var Player = require("./player.js");
var GlyphFactory = require("./glyphFactory.js");
var Symbols = require("./symbols.js");

//require("../../third-party/MIDI.js");

//var paper = Raphael(200, 200, 1600, 2400);
//testGlyph = "M0 0v-507.789h60.6316h60.6314v507.789v507.789h-60.6314h-60.6316v-507.789zM166.737 0v-507.789h15.158h15.158l0.0940094 242.857l0.141998 242.858l5.116 -4.4052c7.295 -6.3 20.179 -20.3211 28.611 -31.1685c32.873 -42.2526 57.789 -96.5846 73.61 -160.721 c4.02701 -16.248 5.73199 -18.474 13.785 -18.474c7.815 0.0469971 10.847 3.97899 11.747 15.205c6.125 78.813 57.937 137.801 118.879 137.801c3.15601 0 6.33701 -0.158195 9.53702 -0.480103c55.184 -5.58949 73.373 -39.8372 76.689 -144.473 c0.601013 -18.779 0.909973 -36.176 0.909973 -52.288c0 -103.299 -12.713 -153.815 -42.831 -177.212c-16.186 -12.579 -40.236 -18.893 -66.192 -18.893c-25.165 0 -52.122 5.935 -75.439 17.85l-2.36899 1.185l1.89499 0.283997 c8.621 1.37399 13.358 2.79501 19.184 5.73102c21.326 10.766 30.892 30.036 30.892 49.405c0 29.632 -22.39 59.495 -59.313 59.495c-37.461 0 -61.945 -30.386 -61.945 -62.217c0 -15.743 5.99002 -31.84 19.361 -44.788c34.784 -33.716 81.115 -50.181 128.567 -50.181 c57.746 0 117.154 24.384 159.433 71.734c36.112 40.473 55.016 91.171 55.016 145.908c0 13.042 -1.073 26.312 -3.24298 39.729c-14.0681 87.3 -72.0941 156.031 -149.4 177.157c-13.309 3.6422 -26.307 5.4563 -38.909 5.4563c-26.735 0 -51.69 -8.1634 -74.064 -24.3563 c-2.36502 -1.7078 -4.44601 -3.0108 -4.897 -3.0108c-0.0370178 0 -0.0630188 0.00869751 -0.0769958 0.0266037c-0.188995 0.189499 -12.221 20.0369 -26.716 44.1l-26.431 43.6737l26.431 43.7211c14.495 24.0157 26.527 43.8631 26.716 44.0526 c0.0139771 0.0179062 0.039978 0.0266037 0.0769958 0.0266037c0.450989 0 2.53198 -1.303 4.897 -3.0108c22.464 -16.2583 47.194 -24.4366 73.696 -24.4366c6.46802 0 13.042 0.487099 19.714 1.4629c80.29 11.7947 147.032 78.9162 166.358 167.258 c3.84302 17.631 5.77399 36.053 5.77399 54.076c0 17.518 -1.82397 34.657 -5.48999 50.324c-22.915 98.413 -111.235 167.013 -208.783 167.013c-9.92398 0 -19.944 -0.709991 -30.001 -2.17099c-45.521 -6.63202 -96.773 -36.19 -111.41 -64.279 c-4.79001 -9.211 -6.94901 -18.708 -6.94901 -27.934c0 -33.358 28.224 -63.177 62.374 -63.177c6.28601 0 12.773 1.01001 19.322 3.19501c26.057 8.711 39.729 32.247 39.729 55.65c0 19.992 -9.97598 39.886 -30.729 50.361 c-5.82599 2.936 -10.563 4.35703 -19.184 5.73102l-1.89499 0.283997l2.36899 1.185c23.317 11.915 50.239 17.85 75.386 17.85c25.938 0 49.987 -6.314 66.245 -18.893c30.088 -23.323 42.829 -73.926 42.829 -177.315c0 -16.085 -0.308044 -33.448 -0.90802 -52.185 c-2.93701 -92.51 -16.91 -127.468 -55.989 -140.257c-10.027 -3.2711 -20.046 -4.8281 -29.879 -4.8281c-59.942 0 -113.011 57.8505 -119.237 137.933c-0.899994 11.226 -3.93198 15.158 -11.747 15.205c-8.05301 0 -9.758 -2.226 -13.785 -18.474 c-15.821 -64.136 -40.737 -118.468 -73.61 -160.721c-8.43201 -10.8474 -21.316 -24.8685 -28.611 -31.1685l-5.116 -4.4052l-0.141998 242.858l-0.0940094 242.857h-15.158h-15.158v-507.789z";
//testGlyph = "M-206.769 126.234c-8.52901 -2.68 -13.007 -10.14 -13.007 -17.835c0 -6.451 3.146 -13.0666 9.69099 -17.1707c1.8 -1.1368 -9.047 1.8 139.074 -37.9894l103.026 -27.7106l71.6689 -19.2789c12.268 -3.31579 22.357 -6.11053 22.357 -6.25263 c0 -0.142105 -10.089 -2.93684 -22.357 -6.25263l-71.6689 -19.2789l-103.026 -27.7105c-148.121 -39.7895 -137.274 -36.8527 -139.074 -37.9895c-6.57199 -4.12849 -9.864 -10.4672 -9.864 -16.8022c0 -6.313 3.26801 -12.621 9.817 -16.735 c2.31801 -1.43999 4.964 -2.16299 8.31801 -2.16299c3.157 0 6.94099 0.640999 11.671 1.92599l161.053 43.2952c228.488 61.4133 240.486 64.527 240.486 65.2851c0 0.0888996 -0.164993 0.145399 -0.164993 0.259899c0 0.0703011 0.0619965 0.162401 0.263 0.2971 c5.63699 3.7421 8.455 9.8053 8.455 15.8685c0 6.06316 -2.81801 12.1263 -8.455 15.8684c-3.174 2.0842 2.274 0.521 -46.137 13.5473l-194.447 52.2948l-161.053 43.2947c-4.80099 1.296 -8.558 1.933 -11.647 1.933c-1.87901 0 -3.51001 -0.236 -4.979 -0.700996z";
//console.log(font);

var testPath = "M359.403 1080.91c-7.621 -2.80005 -37.638 -31.6801 -54.954 -52.88c-56.862 -69.564 -87.028 -156.64 -87.028 -247.587c0 -23.399 1.99699 -47.054 6.049 -70.732c1.037 -6.22101 16.486 -79.528 19.701 -93.577l8.81299 -40.957l7.98399 -37.586l-22.137 -22.293 \
c-63.405 -63.715 -115.248 -124.735 -166.573 -195.967c-47.6846 -66.184 -71.2582 -141.493 -71.2582 -215.793c0 -86.4519 31.9152 -171.537 94.8988 -239.288c63.7742 -68.645 157.378 -107.88 248.941 -107.88c24.405 0 48.665 2.78801 72.176 8.548 \
c4.41602 1.08 8.13501 1.927 8.565 1.927c0.0249939 0 0.0379944 -0.00300598 0.0410156 -0.00900269c0.156006 -0.207001 20.323 -94.251 22.863 -106.849c5.362 -26.344 8.04303 -50.971 8.04303 -73.803c0 -25.739 -3.40701 -49.198 -10.22 -70.269 \
c-21.962 -67.944 -89.714 -113.801 -162.345 -113.801c-9.66702 0 -19.421 0.812012 -29.164 2.49298c-15.916 2.74799 -35.513 8.91699 -46.556 14.724l-2.43599 1.24402l4.50999 0.052002c51.947 0.258972 94.251 43.704 94.251 96.843v0.0639954 \
c0 60.903 -49.755 100.629 -102.135 100.629c-25.878 0 -52.397 -9.69598 -73.873 -31.327c-21.275 -21.412 -32.0448 -48.407 -32.0448 -75.406c0 -23.857 8.40881 -47.717 25.4088 -67.733c42.01 -49.483 102.251 -75.143 162.599 -75.143 \
c45.999 0 92.061 14.909 130.16 45.54c50.448 40.604 75.529 97.486 75.529 171.686c0 13.339 -0.809998 27.237 -2.42999 41.702c-2.073 18.871 -4.66501 32.505 -17.574 92.747c-6.68802 31.417 -12.184 57.287 -12.184 57.495c0 0.259003 2.64401 1.55501 5.85901 2.903 \
c96.07 41.129 160.99 135.723 160.99 233.392c0 2.42 -0.039978 4.8418 -0.120972 7.2647c-4.09503 124.321 -91.399 221.008 -213.387 236.199c-3.77698 0.468994 -12.737 0.694 -22.131 0.694c-11.362 0 -23.358 -0.32901 -27.586 -0.95401 \
c-2.88602 -0.411987 -5.36801 -0.742981 -5.94202 -0.742981c-0.0749817 0 -0.117981 0.00500488 -0.123993 0.0180054c-0.052002 0.0509949 -8.39899 39.193 -18.612 86.941l-18.56 86.837l9.28 8.96899l24.833 23.796c93.318 88.601 139.77 181.659 147.028 294.626 \
c0.414001 6.45001 0.618011 13.029 0.618011 19.713c0 95.296 -41.3 211.963 -100.209 279.061c-15.417 17.5801 -25.878 25.3601 -34.587 25.3601c-1.71597 0 -3.36499 -0.300049 -4.96997 -0.890015zM405.025 938.029c15.294 -2.02197 28.203 -10.576 34.062 -22.448 \
c5.57098 -11.3 8.97501 -33.439 8.97501 -54.775c0 -6.85602 -0.351013 -13.6281 -1.095 -19.932c-8.96902 -76.313 -53.658 -162.114 -127.068 -243.871c-6.95499 -7.77899 -30.547 -32.042 -31.149 -32.042l-0.00900269 0.00299072 \
c-0.415009 0.415039 -21.567 100.784 -22.707 107.679c-2.871 17.671 -4.28699 35.201 -4.28699 52.382c0 54.194 14.092 104.918 41.095 145.659c26.619 40.244 66.071 67.745 96.091 67.745c2.07898 0 4.112 -0.132019 6.09198 -0.400024zM298.85 355.725 \
c5.237 -24.574 9.79898 -46.089 10.214 -47.8c1.651 -7.172 12.546 -58.512 12.546 -59.045v-0.0039978c-0.103973 -0.052002 -1.452 -0.519012 -3.00699 -1.037c-85.973 -28.644 -140.686 -106.965 -140.686 -190.863c0 -19.0575 2.823 -38.4027 8.74399 -57.5188 \
c16.02 -51.7915 54.799 -94.9251 104.257 -116.025c3.89499 -1.667 7.51199 -2.476 10.718 -2.476c7.16602 0 12.28 4.043 13.856 11.6c0.260986 1.269 0.395996 2.461 0.395996 3.596c0 5.6344 -3.34201 9.8285 -11.283 14.7051 \
c-37.122 22.7868 -55.619 61.0151 -55.619 100.107c0 39.7976 19.171 80.4903 57.382 106.696c10.145 6.94099 34.561 18.519 38.779 18.519c0.286987 0 0.480988 -0.0540009 0.570007 -0.166c0.102997 -0.104004 6.065 -27.84 13.272 -61.642l14.101 -66.1003 \
l1.763 -8.03572l8.76102 -40.9562l21.567 -100.784c7.414 -34.786 13.479 -63.508 13.479 -63.819c0 -1.45099 -22.552 -7.465 -36.29 -9.746c-12.705 -2.103 -25.384 -3.127 -37.946 -3.127c-98.609 0 -189.955 63.113 -229.825 162.856 \
c-13.514 33.8666 -20.178 70.0703 -20.178 106.672c0 56.0726 15.64 113.081 46.255 164.054c15.502 25.766 55.836 79.165 93.37 123.646c18.197 21.567 53.917 61.434 55.006 61.434c0.156006 0 4.56201 -20.115 9.798 -44.74zM403.781 140.938 \
c86.237 -9.468 149.006 -85.2966 149.006 -169.824c0 -13.5982 -1.62396 -27.4215 -5.03699 -41.23c-10.524 -42.6156 -38.053 -81.9126 -76.261 -108.768c-6.37802 -4.519 -20.001 -12.832 -20.993 -12.832c-0.0320129 0 -0.0509949 0.00900269 -0.0559998 0.0270081 \
c-0.154999 0.466995 -6.89499 31.832 -8.96899 41.578c-0.777008 3.83699 -15.138 70.9739 -31.831 149.102c-16.694 78.1797 -30.381 142.258 -30.381 142.413c0 0.378998 2.392 0.552994 5.90298 0.552994c5.138 0 12.675 -0.371994 18.619 -1.019z";


renderGlyph = function () {

	// Test stave
	var testStave = Raphael(200, 100, 2000, 2000);
	var stave2 = new Stave(testStave, 100, 100, 400);
	stave2.render();

	var note1 = new Note(60, 4, 200);

	//var player = new Player();

	stave2.drawNotes([note1, note1], 0, 0);

var startX = 100;
var currentY = 300;
var currentX = startX;
var scale = 0.05;
var scaledBoundedBox = GlyphFactory.getScaledBoundingBox(scale);

// -2065.375, -695.53125, 1901.578125, 1159.671875
/*
var scaledBoundedBox = {
	width: (695.53125 + 1159.671875) * scale,
	height: (2065.375 + 1901.578125) * scale
};
*/

/*
for(var i = 0; i < font.length; ++i) {
	console.log("Test" +i);

	var glyphArea = Raphael(currentX, currentY, scaledBoundedBox.width, scaledBoundedBox.height);
	var rect = glyphArea.rect(0, 0, scaledBoundedBox.width, scaledBoundedBox.height);
	glyphArea.text(50, 10, font[i].glyph_name);

	var glyphPath = font[i].d;
	var path = glyphArea.path(glyphPath);
	path.transform("s" + scale +"," +scale +",0,0");

	var circle = glyphArea.circle(0.5 * scaledBoundedBox.width, 0.5 * scaledBoundedBox.height, 2, 2);
	circle.attr("fill", "red");

	currentX += scaledBoundedBox.width;
	if(i > 0 && i % 20 === 0) {
		currentX = startX;
		currentY += scaledBoundedBox.height;
	}
}
*/

var glyphScale = 0.05;
var center = GlyphFactory.getCenter(glyphScale);
var testLine = Raphael(200, 700, 2000, 2000);
var glyphOutline = GlyphFactory.getGlyph(Symbols.G_CLEF);
var glyph = testLine.path(glyphOutline);
glyph.transform("...s" +glyphScale +"," +glyphScale +",0,0");

glyphOutline = GlyphFactory.getGlyph(Symbols.HALF_NOTE);
glyph = testLine.path(glyphOutline);
glyph.transform("...s" +glyphScale +"," +glyphScale +",0,0");
glyph.transform("...T" +50 +"," +0);

glyphOutline = GlyphFactory.getGlyph(Symbols.QUARTER_NOTE);
glyph = testLine.path(glyphOutline);
glyph.transform("...s" +glyphScale +"," +glyphScale +",0,0");
glyph.transform("...T" +100 +"," +0);

testLine.path("M0," +center.y +"h500," +center.y);


};
